<h1>用 Cursor Agent + Metabase MCP 解決行銷人員的「改來改去」問題</h1>
<h2>背景：數據人員的痛點</h2>
<p><img src="/images/ai-generated/cursor-metabase-push-list-management.png" alt="Cursor Agent + Metabase MCP 解決方案"></p>
<p>在許多公司中，推播系統的運作流程是這樣的：</p>
<ol>
<li><strong>行銷人員</strong>決定推送名單的邏輯（例如：「最近 30 天有購買行為的用戶」）</li>
<li><strong>數據人員</strong>透過 Metabase 將這些邏輯聚合成表單</li>
<li>系統根據 Metabase 表單的數據發送推播</li>
</ol>
<p>這個流程看似合理，但在實際運作中卻有一個常見的問題：<strong>行銷人員的需求經常變動</strong>。</p>
<p>今天要「最近 30 天有購買的用戶」，明天改成「最近 14 天有購買且金額超過 1000 的用戶」，後天又變成「最近 7 天有購買但沒有退貨的用戶」。</p>
<p>數據人員每次都要：</p>
<ul>
<li>理解行銷人員的需求</li>
<li>在 Metabase 中建立或修改查詢</li>
<li>驗證結果是否正確</li>
<li>處理各種邊緣情況</li>
</ul>
<p><strong>結果就是：數據人員被行銷人員的「改來改去」搞得疲於奔命。</strong></p>
<h2>傳統解決方案的兩難</h2>
<p>當數據人員提出「能不能寫一個介面讓行銷人員自己調整」時，技術端面臨一個經典的兩難：</p>
<h3>方案 A：簡單介面，功能受限</h3>
<ul>
<li>✅ 行銷人員容易學會</li>
<li>❌ 功能受限，還是要改來改去</li>
<li>❌ 無法應付複雜的查詢需求</li>
</ul>
<h3>方案 B：高度彈性的介面</h3>
<ul>
<li>✅ 功能強大，可以應付各種需求</li>
<li>❌ 複雜度高，行銷人員學不會</li>
<li>❌ 開發成本高，維護困難</li>
</ul>
<p><strong>這就是彈性與易用性的經典矛盾。</strong></p>
<h2>我們的解決方案：Cursor Agent + Metabase MCP</h2>
<p>經過思考，我們找到了一個平衡點：<strong>使用 Cursor Agent 配合 Metabase MCP Server</strong>。</p>
<h3>核心概念</h3>
<ol>
<li><strong>自然語言輸入</strong>：行銷人員用自然語言描述需求</li>
<li><strong>AI 理解與轉換</strong>：Cursor Agent 理解需求並轉換為 Metabase 查詢</li>
<li><strong>直接操作 Metabase</strong>：透過 Metabase MCP 直接建立或修改查詢</li>
<li><strong>權限完全掌控</strong>：API KEY 由技術端管理，行銷人員無法直接存取</li>
</ol>
<h3>技術架構</h3>
<pre><code>行銷人員
  ↓ (自然語言)
Cursor Agent
  ↓ (理解需求，生成查詢)
Metabase MCP Server
  ↓ (API 調用)
Metabase
  ↓ (執行查詢，產出名單)
推送系統
</code></pre>
<h2>Metabase MCP Server 配置</h2>
<p>首先，我們需要在 Cursor 中配置 Metabase MCP Server。在 <code>mcp.json</code> 中加入以下配置：</p>
<pre><code class="language-json">{
  &quot;mcpServers&quot;: {
    &quot;metabase-server&quot;: {
      &quot;command&quot;: &quot;npx&quot;,
      &quot;args&quot;: [&quot;@easecloudio/mcp-metabase-server&quot;],
      &quot;env&quot;: {
        &quot;METABASE_URL&quot;: &quot;http://your-metabase-url:3000/&quot;,
        &quot;METABASE_API_KEY&quot;: &quot;your-api-key-here&quot;
      }
    }
  }
}
</code></pre>
<p><strong>關鍵點</strong>：</p>
<ul>
<li><code>METABASE_URL</code>：你的 Metabase 實例地址</li>
<li><code>METABASE_API_KEY</code>：由技術端管理的 API KEY</li>
<li>行銷人員無法直接看到或修改這些配置</li>
</ul>
<h2>實際使用場景</h2>
<h3>場景 1：建立新的推送名單</h3>
<p><strong>行銷人員輸入</strong>：</p>
<blockquote>
<p>「幫我建立一個名單，包含最近 30 天有購買行為，且購買金額超過 1000 元的用戶，最多 5000 人」</p>
</blockquote>
<p><strong>Cursor Agent 執行</strong>：</p>
<ol>
<li>理解需求：時間範圍（30 天）、條件（購買金額 &gt; 1000）、限制（最多 5000 人）</li>
<li>透過 Metabase MCP 查詢相關表結構</li>
<li>建立 Metabase 查詢（Card）</li>
<li>執行查詢並產出名單</li>
<li>將名單保存到 Metabase 的指定表</li>
</ol>
<p><strong>結果</strong>：</p>
<ul>
<li>行銷人員用自然語言就完成了複雜的查詢建立</li>
<li>數據人員不需要介入</li>
<li>API KEY 權限完全由技術端掌控</li>
</ul>
<h3>場景 2：修改現有名單</h3>
<p><strong>行銷人員輸入</strong>：</p>
<blockquote>
<p>「把昨天的推送名單改成最近 14 天，其他條件不變」</p>
</blockquote>
<p><strong>Cursor Agent 執行</strong>：</p>
<ol>
<li>找到昨天的推送名單（透過 Metabase MCP 查詢）</li>
<li>理解「其他條件不變」的語義</li>
<li>修改查詢中的時間範圍</li>
<li>更新 Metabase 中的查詢</li>
<li>重新執行並產出新的名單</li>
</ol>
<h3>場景 3：複雜的多條件查詢</h3>
<p><strong>行銷人員輸入</strong>：</p>
<blockquote>
<p>「我要最近 7 天有購買，但沒有退貨記錄，且不在黑名單中的用戶，按購買金額降序排列，取前 3000 名」</p>
</blockquote>
<p><strong>Cursor Agent 執行</strong>：</p>
<ol>
<li>解析多個條件：時間、購買行為、退貨排除、黑名單排除、排序、限制</li>
<li>透過 Metabase MCP 查詢相關表的關聯關係</li>
<li>建立複雜的 JOIN 查詢</li>
<li>執行並驗證結果</li>
<li>產出名單並保存</li>
</ol>
<h2>優勢分析</h2>
<h3>1. 解決彈性與易用性的矛盾</h3>
<ul>
<li><strong>自然語言</strong>：行銷人員不需要學習複雜的查詢語法</li>
<li><strong>高度彈性</strong>：AI 可以理解各種複雜的需求描述</li>
<li><strong>即時反饋</strong>：可以立即看到查詢結果，快速調整</li>
</ul>
<h3>2. 權限完全掌控</h3>
<ul>
<li><strong>API KEY 管理</strong>：由技術端統一管理，行銷人員無法直接存取</li>
<li><strong>操作記錄</strong>：所有操作都透過 Cursor Agent，可以記錄和審計</li>
<li><strong>安全可控</strong>：技術端可以隨時調整權限範圍</li>
</ul>
<h3>3. 降低溝通成本</h3>
<ul>
<li><strong>減少來回確認</strong>：行銷人員可以直接描述需求，不需要反覆溝通</li>
<li><strong>即時調整</strong>：發現問題可以立即修改，不需要等待數據人員</li>
<li><strong>學習成本低</strong>：行銷人員只需要會用自然語言描述需求</li>
</ul>
<h3>4. 釋放數據人員時間</h3>
<ul>
<li><strong>專注高價值工作</strong>：數據人員可以專注於數據分析、建模等高價值工作</li>
<li><strong>減少重複勞動</strong>：不需要反覆建立和修改簡單的查詢</li>
<li><strong>提升整體效率</strong>：整個團隊的效率都得到提升</li>
</ul>
<h2>技術實現細節</h2>
<h3>Metabase MCP Server 的主要功能</h3>
<p>Metabase MCP Server 提供了豐富的功能，包括：</p>
<ol>
<li><strong>查詢執行</strong>：執行 SQL 查詢或 MBQL 查詢</li>
<li><strong>Card 管理</strong>：建立、更新、刪除查詢卡片</li>
<li><strong>Dashboard 管理</strong>：管理儀表板</li>
<li><strong>數據庫結構查詢</strong>：查詢表結構、欄位信息等</li>
<li><strong>結果導出</strong>：將查詢結果導出為各種格式</li>
</ol>
<h3>Cursor Agent 的工作流程</h3>
<ol>
<li><strong>需求理解</strong>：使用 LLM 理解行銷人員的自然語言需求</li>
<li><strong>查詢生成</strong>：根據需求生成 Metabase 查詢</li>
<li><strong>結構查詢</strong>：先查詢相關表的結構，確保查詢正確</li>
<li><strong>執行驗證</strong>：執行查詢並驗證結果</li>
<li><strong>結果保存</strong>：將結果保存到指定的表或 Card</li>
</ol>
<h3>錯誤處理</h3>
<ul>
<li><strong>語義理解錯誤</strong>：如果 AI 理解錯誤，行銷人員可以重新描述</li>
<li><strong>查詢錯誤</strong>：如果查詢有問題，AI 會根據錯誤訊息調整</li>
<li><strong>權限錯誤</strong>：如果權限不足，會明確提示需要技術端協助</li>
</ul>
<h2>實際效果</h2>
<h3>使用前</h3>
<ul>
<li>行銷人員提出需求 → 數據人員理解（可能理解錯誤）→ 建立查詢 → 行銷人員驗證 → 發現問題 → 再次修改 → ...</li>
<li><strong>平均每個需求需要 2-3 次來回</strong></li>
<li><strong>數據人員每天處理 10+ 個類似需求</strong></li>
</ul>
<h3>使用後</h3>
<ul>
<li>行銷人員直接描述需求 → Cursor Agent 執行 → 立即看到結果 → 如有問題直接調整</li>
<li><strong>大部分需求一次完成</strong></li>
<li><strong>數據人員可以專注於更複雜的分析工作</strong></li>
</ul>
<h2>注意事項</h2>
<h3>1. API KEY 安全</h3>
<ul>
<li><strong>不要將 API KEY 寫在文章中或公開場所</strong></li>
<li>使用環境變數或安全的配置管理系統</li>
<li>定期輪換 API KEY</li>
</ul>
<h3>2. 權限範圍控制</h3>
<ul>
<li>建議建立專門的 Metabase 用戶，只給予必要的權限</li>
<li>限制可以操作的數據庫和表</li>
<li>避免給予刪除或修改核心數據的權限</li>
</ul>
<h3>3. 查詢驗證</h3>
<ul>
<li>對於重要的推送名單，建議加入人工審核流程</li>
<li>可以設定查詢結果的合理性檢查（例如：人數不能超過某個上限）</li>
<li>記錄所有操作，方便回溯和審計</li>
</ul>
<h3>4. 培訓與文檔</h3>
<ul>
<li>雖然使用自然語言，但還是需要培訓行銷人員如何更好地描述需求</li>
<li>提供常見需求的範例</li>
<li>建立問題反饋機制</li>
</ul>
<h2>未來擴展</h2>
<p>這個方案還有許多可以擴展的方向：</p>
<ol>
<li><strong>模板化</strong>：將常見需求模板化，進一步簡化操作</li>
<li><strong>預覽功能</strong>：在執行前預覽查詢結果，避免錯誤</li>
<li><strong>版本控制</strong>：記錄查詢的歷史版本，方便回滾</li>
<li><strong>自動化排程</strong>：定期自動執行某些查詢並更新名單</li>
<li><strong>結果分析</strong>：自動分析查詢結果，提供洞察建議</li>
</ol>
<h2>結論</h2>
<p>使用 <strong>Cursor Agent + Metabase MCP</strong> 的方案，成功解決了行銷人員「改來改去」的問題：</p>
<ul>
<li>✅ <strong>彈性與易用性並存</strong>：自然語言輸入，高度彈性的查詢能力</li>
<li>✅ <strong>權限完全掌控</strong>：API KEY 由技術端管理，安全可控</li>
<li>✅ <strong>降低溝通成本</strong>：減少來回確認，提升效率</li>
<li>✅ <strong>釋放數據人員時間</strong>：專注高價值工作</li>
</ul>
<p>這個方案不僅解決了當下的痛點，更重要的是展示了 <strong>AI Agent 在實際業務場景中的應用價值</strong>。透過合理的架構設計，我們可以在保持安全性的同時，大幅提升業務效率。</p>
<hr>
<p><em>這篇文章記錄了使用 Cursor Agent 配合 Metabase MCP 解決實際業務問題的經驗，希望對面臨類似挑戰的團隊有所幫助。</em></p>
